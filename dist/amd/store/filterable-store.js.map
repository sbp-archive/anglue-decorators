{"version":3,"sources":["src/store/filterable-store.js"],"names":[],"mappings":"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","file":"src/store/filterable-store.js","sourcesContent":["import DecoratorUtils from '../utils';\n\nexport class FilterableStoreDecorator {\n    static decorateClass(cls) {\n        DecoratorUtils.addInjections(cls, {\n            'filterService': '$filter'\n        });\n    }\n\n    static decorate(owner) {\n        var filterable = new FilterableStoreDecorator(owner);\n\n        Object.defineProperties(owner, {\n            filterable: {\n                value: filterable\n            },\n            filtered: {\n                get: () => {\n                    return filterable.filtered;\n                }\n            }\n        });\n\n        DecoratorUtils.intercept(owner, filterable, 'doFilter');\n        DecoratorUtils.intercept(owner, filterable, 'onFilterChange');\n        DecoratorUtils.intercept(owner, filterable, 'onFilterClear');\n        DecoratorUtils.intercept(owner, filterable, 'onSearchChange');\n        DecoratorUtils.intercept(owner, filterable, 'onSearchClear');\n        DecoratorUtils.intercept(owner, filterable, 'onItemsFiltered');\n        DecoratorUtils.sequence(owner, filterable, 'onItemsChanged');\n    }\n\n    constructor(owner) {\n        this.owner = owner;\n\n        this.filtered = [];\n        this.filters = new Map();\n    }\n\n    onItemsChanged() {\n        this.doFilter();\n    }\n\n    doFilter() {\n        var filtered = this.owner.items.slice();\n        for (let filterFn of this.filters.values()) {\n            filtered = filterFn(filtered);\n        }\n        this.filtered = filtered;\n        this.owner.onItemsFiltered(filtered);\n    }\n\n    onFilterChange(filterName, filter) {\n        if (Object.prototype.toString.call(filter) === '[object String]') {\n            this.filters.set(filterName, (items) => {\n                return this.owner.filterService('filter')(items, filter);\n            });\n        } else {\n            this.filters.set(filterName, (items) => {\n                return items.filter((item) => {\n                    var exclude = filter.exclude;\n                    var filterProperty = filter.property;\n                    var filterValues = filter.value;\n                    var value = item[filterProperty];\n\n                    if (filterValues) {\n                        if (!Array.isArray(filterValues)) {\n                            filterValues = [filterValues];\n                        }\n\n                        for (let i = 0, ln = filterValues.length; i < ln; i++) {\n                            let filterValue = filterValues[i];\n                            if (value === filterValue) {\n                                return !exclude;\n                            }\n                        }\n                    }\n\n                    return !!exclude;\n                });\n            });\n        }\n        this.doFilter();\n    }\n\n    onFilterClear(filterName) {\n        this.filters.delete(filterName);\n        this.doFilter();\n    }\n\n    onSearchClear() {\n        this.onFilterClear('__search');\n    }\n\n    onSearchChange(expression) {\n        this.onFilterChange('__search', expression);\n    }\n\n    onItemsFiltered() {}\n}\n\nexport default FilterableStoreDecorator;\n"]}