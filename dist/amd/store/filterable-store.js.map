{"version":3,"sources":["src/store/filterable-store.js"],"names":[],"mappings":";;;;;;;;;;;;;;;QAEa,wBAAwB;AA8BtB,iBA9BF,wBAAwB,CA8BrB,KAAK,EAAE;kCA9BV,wBAAwB;;AA+B7B,gBAAI,CAAC,KAAK,GAAG,KAAK,CAAC;;AAEnB,gBAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;AACnB,gBAAI,CAAC,OAAO,GAAG,IAAI,GAAG,EAAE,CAAC;SAC5B;;qBAnCQ,wBAAwB;;mBAqCnB,0BAAG;AACb,oBAAI,CAAC,QAAQ,EAAE,CAAC;aACnB;;;mBAEO,oBAAG;AACP,oBAAI,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC;;;;;;AACxC,yCAAqB,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,8HAAE;4BAAnC,QAAQ;;AACb,gCAAQ,GAAG,QAAQ,CAAC,QAAQ,CAAC,CAAC;qBACjC;;;;;;;;;;;;;;;;AACD,oBAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;AACzB,oBAAI,CAAC,KAAK,CAAC,eAAe,CAAC,QAAQ,CAAC,CAAC;aACxC;;;mBAEa,wBAAC,UAAU,EAAE,MAAM,EAAE;;;AAC/B,oBAAI,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,iBAAiB,EAAE;AAC9D,wBAAI,CAAC,OAAO,CAAC,GAAG,CAAC,UAAU,EAAE,UAAC,KAAK,EAAK;AACpC,+BAAO,MAAK,KAAK,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC;qBAC5D,CAAC,CAAC;iBACN,MAAM;AACH,wBAAI,CAAC,OAAO,CAAC,GAAG,CAAC,UAAU,EAAE,UAAC,KAAK,EAAK;AACpC,+BAAO,KAAK,CAAC,MAAM,CAAC,UAAC,IAAI,EAAK;AAC1B,gCAAI,OAAO,GAAG,MAAM,CAAC,OAAO,CAAC;AAC7B,gCAAI,cAAc,GAAG,MAAM,CAAC,QAAQ,CAAC;AACrC,gCAAI,YAAY,GAAG,MAAM,CAAC,KAAK,CAAC;AAChC,gCAAI,KAAK,GAAG,IAAI,CAAC,cAAc,CAAC,CAAC;;AAEjC,gCAAI,YAAY,EAAE;AACd,oCAAI,CAAC,KAAK,CAAC,OAAO,CAAC,YAAY,CAAC,EAAE;AAC9B,gDAAY,GAAG,CAAC,YAAY,CAAC,CAAC;iCACjC;;AAED,qCAAK,IAAI,CAAC,GAAG,CAAC,EAAE,EAAE,GAAG,YAAY,CAAC,MAAM,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,EAAE,EAAE;AACnD,wCAAI,WAAW,GAAG,YAAY,CAAC,CAAC,CAAC,CAAC;AAClC,wCAAI,KAAK,KAAK,WAAW,EAAE;AACvB,+CAAO,CAAC,OAAO,CAAC;qCACnB;iCACJ;6BACJ;;AAED,mCAAO,CAAC,CAAC,OAAO,CAAC;yBACpB,CAAC,CAAC;qBACN,CAAC,CAAC;iBACN;AACD,oBAAI,CAAC,QAAQ,EAAE,CAAC;aACnB;;;mBAEY,uBAAC,UAAU,EAAE;AACtB,oBAAI,CAAC,OAAO,UAAO,CAAC,UAAU,CAAC,CAAC;AAChC,oBAAI,CAAC,QAAQ,EAAE,CAAC;aACnB;;;mBAEY,yBAAG;AACZ,oBAAI,CAAC,aAAa,CAAC,UAAU,CAAC,CAAC;aAClC;;;mBAEa,wBAAC,UAAU,EAAE;AACvB,oBAAI,CAAC,cAAc,CAAC,UAAU,EAAE,UAAU,CAAC,CAAC;aAC/C;;;mBAEc,2BAAG,EAAE;;;mBA/FA,uBAAC,GAAG,EAAE;AACtB,gCAAe,aAAa,CAAC,GAAG,EAAE;AAC9B,mCAAe,EAAE,SAAS;iBAC7B,CAAC,CAAC;aACN;;;mBAEc,kBAAC,KAAK,EAAE;AACnB,oBAAI,UAAU,GAAG,IAAI,wBAAwB,CAAC,KAAK,CAAC,CAAC;;AAErD,sBAAM,CAAC,gBAAgB,CAAC,KAAK,EAAE;AAC3B,8BAAU,EAAE;AACR,6BAAK,EAAE,UAAU;qBACpB;AACD,4BAAQ,EAAE;AACN,2BAAG,EAAE,eAAM;AACP,mCAAO,UAAU,CAAC,QAAQ,CAAC;yBAC9B;qBACJ;iBACJ,CAAC,CAAC;;AAEH,gCAAe,SAAS,CAAC,KAAK,EAAE,UAAU,EAAE,UAAU,CAAC,CAAC;AACxD,gCAAe,SAAS,CAAC,KAAK,EAAE,UAAU,EAAE,gBAAgB,CAAC,CAAC;AAC9D,gCAAe,SAAS,CAAC,KAAK,EAAE,UAAU,EAAE,eAAe,CAAC,CAAC;AAC7D,gCAAe,SAAS,CAAC,KAAK,EAAE,UAAU,EAAE,gBAAgB,CAAC,CAAC;AAC9D,gCAAe,SAAS,CAAC,KAAK,EAAE,UAAU,EAAE,eAAe,CAAC,CAAC;AAC7D,gCAAe,SAAS,CAAC,KAAK,EAAE,UAAU,EAAE,iBAAiB,CAAC,CAAC;AAC/D,gCAAe,QAAQ,CAAC,KAAK,EAAE,UAAU,EAAE,gBAAgB,CAAC,CAAC;aAChE;;;eA5BQ,wBAAwB;;;YAAxB,wBAAwB,GAAxB,wBAAwB;yBAmGtB,wBAAwB","file":"src/store/filterable-store.js","sourcesContent":["import DecoratorUtils from '../utils';\n\nexport class FilterableStoreDecorator {\n    static decorateClass(cls) {\n        DecoratorUtils.addInjections(cls, {\n            'filterService': '$filter'\n        });\n    }\n\n    static decorate(owner) {\n        var filterable = new FilterableStoreDecorator(owner);\n\n        Object.defineProperties(owner, {\n            filterable: {\n                value: filterable\n            },\n            filtered: {\n                get: () => {\n                    return filterable.filtered;\n                }\n            }\n        });\n\n        DecoratorUtils.intercept(owner, filterable, 'doFilter');\n        DecoratorUtils.intercept(owner, filterable, 'onFilterChange');\n        DecoratorUtils.intercept(owner, filterable, 'onFilterClear');\n        DecoratorUtils.intercept(owner, filterable, 'onSearchChange');\n        DecoratorUtils.intercept(owner, filterable, 'onSearchClear');\n        DecoratorUtils.intercept(owner, filterable, 'onItemsFiltered');\n        DecoratorUtils.sequence(owner, filterable, 'onItemsChanged');\n    }\n\n    constructor(owner) {\n        this.owner = owner;\n\n        this.filtered = [];\n        this.filters = new Map();\n    }\n\n    onItemsChanged() {\n        this.doFilter();\n    }\n\n    doFilter() {\n        var filtered = this.owner.items.slice();\n        for (let filterFn of this.filters.values()) {\n            filtered = filterFn(filtered);\n        }\n        this.filtered = filtered;\n        this.owner.onItemsFiltered(filtered);\n    }\n\n    onFilterChange(filterName, filter) {\n        if (Object.prototype.toString.call(filter) === '[object String]') {\n            this.filters.set(filterName, (items) => {\n                return this.owner.filterService('filter')(items, filter);\n            });\n        } else {\n            this.filters.set(filterName, (items) => {\n                return items.filter((item) => {\n                    var exclude = filter.exclude;\n                    var filterProperty = filter.property;\n                    var filterValues = filter.value;\n                    var value = item[filterProperty];\n\n                    if (filterValues) {\n                        if (!Array.isArray(filterValues)) {\n                            filterValues = [filterValues];\n                        }\n\n                        for (let i = 0, ln = filterValues.length; i < ln; i++) {\n                            let filterValue = filterValues[i];\n                            if (value === filterValue) {\n                                return !exclude;\n                            }\n                        }\n                    }\n\n                    return !!exclude;\n                });\n            });\n        }\n        this.doFilter();\n    }\n\n    onFilterClear(filterName) {\n        this.filters.delete(filterName);\n        this.doFilter();\n    }\n\n    onSearchClear() {\n        this.onFilterClear('__search');\n    }\n\n    onSearchChange(expression) {\n        this.onFilterChange('__search', expression);\n    }\n\n    onItemsFiltered() {}\n}\n\nexport default FilterableStoreDecorator;\n"]}